(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{5577:(e,s,t)=>{Promise.resolve().then(t.bind(t,1997))},1997:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var a=t(5155),r=t(2115),l=t(315),n=t(5007),i=t(4085),c=t(2336),d=t(3239),o=t(3075);let x=(0,t(7401).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var m=t(747),h=t(9602);function u(){let[e,s]=(0,r.useState)(""),[t,u]=(0,r.useState)("input"),[f,N]=(0,r.useState)(!1),[p,b]=(0,r.useState)(""),[j,g]=(0,r.useState)(null),w=async()=>{if(8!==e.length){b("Reward code must be exactly 8 characters");return}N(!0),b("");try{let{data:s,error:t}=await m.N.from("rewards").select("*").eq("code_part1",e.toUpperCase()).single();if(t||!s){b("Reward code not found. Please verify the code."),u("error");return}if("CLAIMED"===s.status){b("This reward has already been claimed"),u("error");return}if("EXPIRED"===s.status){b("This reward has expired"),u("error");return}g(s),u("verified")}catch(e){b("An error occurred. Please try again."),u("error")}finally{N(!1)}},v=async()=>{if(j){N(!0);try{let{error:e}=await m.N.from("rewards").update({status:"CLAIMED",claimed_at:new Date().toISOString()}).eq("id",j.id);if(e)throw e;u("success")}catch(e){b("Failed to claim reward. Please try again."),u("error")}finally{N(!1)}}},y=()=>{s(""),u("input"),b(""),g(null)};return(0,a.jsx)(l.N,{pageTitle:"Claim Reward",children:(0,a.jsxs)("div",{className:"mx-auto max-w-2xl",children:["input"===t&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Enter Reward Code"})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Reward Code (8 characters)"}),(0,a.jsx)(c.p,{value:e,onChange:e=>s(e.target.value.toUpperCase()),placeholder:"ABC12345",maxLength:8,className:"mt-2 font-mono text-lg",disabled:f}),(0,a.jsx)("p",{className:"mt-2 text-xs text-slate-500",children:"Enter the first part of the reward code shown to the customer"})]}),(0,a.jsx)(i.$,{onClick:w,className:"w-full",disabled:f||8!==e.length,children:f?"Verifying...":"Verify Code"})]})]}),"verified"===t&&j&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[(0,a.jsx)(d.A,{className:"h-6 w-6 text-green-500"}),(0,a.jsx)("span",{children:"Valid Reward Code"})]})}),(0,a.jsxs)(n.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"rounded-lg bg-slate-50 p-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-slate-600",children:"Reward Code"}),(0,a.jsx)("p",{className:"mt-2 font-mono text-2xl font-bold text-slate-900",children:String(j.code_part1)})]}),(0,a.jsxs)("div",{className:"mt-6 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-slate-600",children:"Reward Value"}),(0,a.jsx)("p",{className:"mt-2 text-4xl font-bold text-blue-600",children:(0,h.vv)(Number(j.reward_value))}),(0,a.jsx)("p",{className:"mt-2 text-xs font-medium uppercase tracking-wide text-slate-500",children:"Preview Only"})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(i.$,{onClick:y,variant:"secondary",className:"flex-1",children:"Cancel"}),(0,a.jsx)(i.$,{onClick:v,className:"flex-1",disabled:f,children:f?"Processing...":"Claim Reward"})]})]})]}),"success"===t&&j&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2 text-green-600",children:[(0,a.jsx)(d.A,{className:"h-6 w-6"}),(0,a.jsx)("span",{children:"Claim Accepted!"})]})}),(0,a.jsxs)(n.Wu,{className:"space-y-6",children:[(0,a.jsx)("div",{className:"rounded-lg bg-green-50 p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(o.A,{className:"mx-auto h-16 w-16 text-green-500"}),(0,a.jsx)("p",{className:"mt-4 text-sm font-medium text-slate-600",children:"Full Reward Code"}),(0,a.jsx)("p",{className:"mt-2 font-mono text-xl font-bold text-slate-900",children:String(j.full_code)}),(0,a.jsx)("p",{className:"mt-6 text-sm font-medium text-slate-600",children:"Reward Value"}),(0,a.jsx)("p",{className:"mt-2 text-4xl font-bold text-green-600",children:(0,h.vv)(Number(j.reward_value))}),(0,a.jsxs)("p",{className:"mt-4 text-xs text-slate-500",children:["Claimed: ",new Date().toLocaleString()]})]})}),(0,a.jsx)(i.$,{onClick:y,className:"w-full",children:"Claim Another Reward"})]})]}),"error"===t&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2 text-red-600",children:[(0,a.jsx)(x,{className:"h-6 w-6"}),(0,a.jsx)("span",{children:"Claim Failed"})]})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"rounded-lg bg-red-50 p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-800",children:p})}),(0,a.jsx)(i.$,{onClick:y,className:"w-full",children:"Try Again"})]})]})]})})}},315:(e,s,t)=>{"use strict";t.d(s,{N:()=>v});var a=t(5155),r=t(2115),l=t(6046),n=t(8173),i=t.n(n),c=t(6507),d=t(9110),o=t(9486),x=t(2423),m=t(3075),h=t(2823),u=t(9136),f=t(9602);let N=[{href:"/dashboard",label:"Dashboard",icon:(0,a.jsx)(c.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN","TENANT_MARKETING_ADMIN","MERCHANT_ADMIN"]},{href:"/tenants",label:"Tenants",icon:(0,a.jsx)(d.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN"]},{href:"/merchants",label:"Merchants",icon:(0,a.jsx)(o.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN"]},{href:"/events",label:"Events",icon:(0,a.jsx)(x.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN","TENANT_MARKETING_ADMIN"]},{href:"/rewards",label:"Rewards",icon:(0,a.jsx)(m.A,{className:"h-5 w-5"}),roles:["MERCHANT_ADMIN"]},{href:"/rewards/claim",label:"Claim Reward",icon:(0,a.jsx)(m.A,{className:"h-5 w-5"}),roles:["MERCHANT_ADMIN"]},{href:"/users",label:"Users",icon:(0,a.jsx)(h.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN"]},{href:"/analytics",label:"Analytics",icon:(0,a.jsx)(u.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN","TENANT_MARKETING_ADMIN","MERCHANT_ADMIN"]}];function p(e){let{userRole:s}=e,t=(0,l.usePathname)(),r=N.filter(e=>e.roles.includes(s));return(0,a.jsxs)("div",{className:"flex h-full w-64 flex-col bg-slate-800 text-white",children:[(0,a.jsx)("div",{className:"flex h-16 items-center justify-center border-b border-slate-700 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"rounded-lg bg-blue-600 p-2",children:(0,a.jsx)(m.A,{className:"h-6 w-6"})}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Merchant App"})]})}),(0,a.jsx)("nav",{className:"flex-1 space-y-1 px-3 py-4",children:r.map(e=>{let s=t===e.href||(null==t?void 0:t.startsWith(e.href+"/"));return(0,a.jsxs)(i(),{href:e.href,className:(0,f.cn)("flex items-center space-x-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors",s?"bg-slate-700 text-white":"text-slate-300 hover:bg-slate-700 hover:text-white"),children:[e.icon,(0,a.jsx)("span",{children:e.label})]},e.href)})})]})}var b=t(1466),j=t(5236),g=t(4085);function w(e){let{user:s,pageTitle:t}=e,r=(0,l.useRouter)(),n=async()=>{await fetch("/api/auth/logout",{method:"POST"}),r.push("/login")};return(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between border-b border-slate-200 bg-white px-6",children:[(0,a.jsx)("div",{children:t&&(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:t})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"rounded-full bg-blue-100 p-2",children:(0,a.jsx)(b.A,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("div",{className:"font-medium text-slate-900",children:s.name}),(0,a.jsx)("div",{className:"text-slate-500",children:s.role.replace(/_/g," ")})]})]}),(0,a.jsxs)(g.$,{variant:"ghost",size:"sm",onClick:n,className:"flex items-center space-x-2",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Logout"})]})]})]})}function v(e){let{children:s,pageTitle:t}=e,n=(0,l.useRouter)(),[i,c]=(0,r.useState)(null),[d,o]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me"),s=await e.json();s.success&&s.user?c(s.user):n.push("/login")}catch(e){n.push("/login")}finally{o(!1)}})()},[n]),d)?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-slate-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-600 border-t-transparent mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-slate-600",children:"Loading..."})]})}):i?(0,a.jsxs)("div",{className:"flex h-screen bg-slate-50",children:[(0,a.jsx)(p,{userRole:i.role}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col overflow-hidden",children:[(0,a.jsx)(w,{user:i,pageTitle:t}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:s})]})]}):null}},4085:(e,s,t)=>{"use strict";t.d(s,{$:()=>n});var a=t(5155),r=t(2115),l=t(9602);let n=r.forwardRef((e,s)=>{let{className:t,variant:r="primary",size:n="md",...i}=e;return(0,a.jsx)("button",{className:(0,l.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus-visible:ring-blue-600",secondary:"border border-slate-200 bg-transparent text-slate-700 hover:bg-slate-100 focus-visible:ring-slate-400",danger:"bg-red-500 text-white hover:bg-red-600 focus-visible:ring-red-500",ghost:"bg-transparent text-slate-500 hover:bg-slate-100 focus-visible:ring-slate-400"}[r],{sm:"h-9 px-3 text-sm",md:"h-10 px-4 py-2",lg:"h-11 px-8 text-lg"}[n],t),ref:s,...i})});n.displayName="Button"},5007:(e,s,t)=>{"use strict";t.d(s,{BT:()=>d,Wu:()=>o,ZB:()=>c,Zp:()=>n,aR:()=>i});var a=t(5155),r=t(2115),l=t(9602);let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("rounded-lg border border-slate-200 bg-white shadow-sm",t),...r})});n.displayName="Card";let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...r})});i.displayName="CardHeader";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});c.displayName="CardTitle";let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-slate-500",t),...r})});d.displayName="CardDescription";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",t),...r})});o.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter"},2336:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var a=t(5155),r=t(2115),l=t(9602);let n=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},747:(e,s,t)=>{"use strict";t.d(s,{N:()=>a});let a=(0,t(838).UU)("https://rovlqyyjsfksgqbmxkwc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvdmxxeXlqc2Zrc2dxYm14a3djIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4ODU1OTgsImV4cCI6MjA3ODQ2MTU5OH0.RDqUziNPvtHu3rENURDu4pVE6fNnMh9wUgIQ-eZpSoQ")},9602:(e,s,t)=>{"use strict";t.d(s,{Yq:()=>i,cn:()=>l,qY:()=>d,r6:()=>c,vv:()=>n});var a=t(3463),r=t(9795);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}function n(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(e)}function i(e){return new Intl.DateTimeFormat("en-IN",{year:"numeric",month:"short",day:"numeric"}).format(new Date(e))}function c(e){return new Intl.DateTimeFormat("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e))}function d(e){return({ACTIVE:"bg-green-100 text-green-800",INACTIVE:"bg-gray-100 text-gray-800",DRAFT:"bg-gray-100 text-gray-800",EXPIRED:"bg-red-100 text-red-800",CANCELLED:"bg-red-100 text-red-800",AVAILABLE:"bg-green-100 text-green-800",DISTRIBUTED:"bg-amber-100 text-amber-800",CLAIMED:"bg-blue-100 text-blue-800"})[e]||"bg-gray-100 text-gray-800"}},3239:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7401).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[946,749,441,517,358],()=>s(5577)),_N_E=e.O()}]);