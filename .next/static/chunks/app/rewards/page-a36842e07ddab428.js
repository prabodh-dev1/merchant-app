(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{6850:(e,s,t)=>{Promise.resolve().then(t.bind(t,263))},263:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var a=t(5155),l=t(2115),r=t(315),n=t(5007),i=t(9286),c=t(6878),d=t(3239),x=t(3075),o=t(747),m=t(9602);function u(){let[e,s]=(0,l.useState)([]),[t,u]=(0,l.useState)("outstanding"),[h,f]=(0,l.useState)(!0),[N,b]=(0,l.useState)({outstanding:0,claimed:0,totalValue:0});(0,l.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await o.N.from("rewards").select("*").order("created_at",{ascending:!1});if(t)throw t;let a=e||[];s(a);let l=a.filter(e=>"AVAILABLE"===e.status||"DISTRIBUTED"===e.status),r=a.filter(e=>"CLAIMED"===e.status),n=r.reduce((e,s)=>e+Number(s.reward_value),0);b({outstanding:l.length,claimed:r.length,totalValue:n})}catch(e){console.error("Error fetching rewards:",e)}finally{f(!1)}})()},[]);let p="outstanding"===t?e.filter(e=>"AVAILABLE"===e.status||"DISTRIBUTED"===e.status):e.filter(e=>"CLAIMED"===e.status);return h?(0,a.jsx)(r.N,{pageTitle:"Rewards Dashboard",children:(0,a.jsx)("div",{className:"text-center",children:"Loading rewards..."})}):(0,a.jsxs)(r.N,{pageTitle:"Rewards Dashboard",children:[(0,a.jsxs)("div",{className:"mb-6 grid gap-6 md:grid-cols-3",children:[(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:"Outstanding Rewards"}),(0,a.jsx)(c.A,{className:"h-4 w-4 text-amber-500"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:N.outstanding}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Available and distributed"})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:"Claimed Rewards"}),(0,a.jsx)(d.A,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:N.claimed}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Successfully redeemed"})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:"Total Value Claimed"}),(0,a.jsx)(x.A,{className:"h-4 w-4 text-blue-500"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:(0,m.vv)(N.totalValue)}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Cumulative reward value"})]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("button",{onClick:()=>u("outstanding"),className:"px-4 py-2 text-sm font-medium transition-colors ".concat("outstanding"===t?"border-b-2 border-blue-600 text-blue-600":"text-slate-600 hover:text-slate-900"),children:["Outstanding (",N.outstanding,")"]}),(0,a.jsxs)("button",{onClick:()=>u("claimed"),className:"px-4 py-2 text-sm font-medium transition-colors ".concat("claimed"===t?"border-b-2 border-blue-600 text-blue-600":"text-slate-600 hover:text-slate-900"),children:["Claimed (",N.claimed,")"]})]})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"border-b border-slate-200 bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-900",children:"Reward Code"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-900",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-900",children:"Value"}),"claimed"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-900",children:"Customer ID"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-900",children:"Claimed At"})]})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-200",children:p.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 font-mono text-sm text-slate-900",children:"claimed"===t?e.full_code:e.code_part1}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)(i.E,{status:e.status,children:e.status})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm font-semibold text-slate-900",children:(0,m.vv)(Number(e.reward_value))}),"claimed"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.customer_id||"N/A"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.claimed_at?(0,m.r6)(e.claimed_at):"N/A"})]})]},e.id))})]})})})]})]})}},315:(e,s,t)=>{"use strict";t.d(s,{N:()=>y});var a=t(5155),l=t(2115),r=t(6046),n=t(8173),i=t.n(n),c=t(6507),d=t(9110),x=t(9486),o=t(2423),m=t(3075),u=t(2823),h=t(9136),f=t(9602);let N=[{href:"/dashboard",label:"Dashboard",icon:(0,a.jsx)(c.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN","TENANT_MARKETING_ADMIN","MERCHANT_ADMIN"]},{href:"/tenants",label:"Tenants",icon:(0,a.jsx)(d.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN"]},{href:"/merchants",label:"Merchants",icon:(0,a.jsx)(x.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN"]},{href:"/events",label:"Events",icon:(0,a.jsx)(o.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN","TENANT_MARKETING_ADMIN"]},{href:"/rewards",label:"Rewards",icon:(0,a.jsx)(m.A,{className:"h-5 w-5"}),roles:["MERCHANT_ADMIN"]},{href:"/rewards/claim",label:"Claim Reward",icon:(0,a.jsx)(m.A,{className:"h-5 w-5"}),roles:["MERCHANT_ADMIN"]},{href:"/users",label:"Users",icon:(0,a.jsx)(u.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN"]},{href:"/analytics",label:"Analytics",icon:(0,a.jsx)(h.A,{className:"h-5 w-5"}),roles:["SUPER_ADMIN","TENANT_MARKETING_ADMIN","MERCHANT_ADMIN"]}];function b(e){let{userRole:s}=e,t=(0,r.usePathname)(),l=N.filter(e=>e.roles.includes(s));return(0,a.jsxs)("div",{className:"flex h-full w-64 flex-col bg-slate-800 text-white",children:[(0,a.jsx)("div",{className:"flex h-16 items-center justify-center border-b border-slate-700 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"rounded-lg bg-blue-600 p-2",children:(0,a.jsx)(m.A,{className:"h-6 w-6"})}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Merchant App"})]})}),(0,a.jsx)("nav",{className:"flex-1 space-y-1 px-3 py-4",children:l.map(e=>{let s=t===e.href||(null==t?void 0:t.startsWith(e.href+"/"));return(0,a.jsxs)(i(),{href:e.href,className:(0,f.cn)("flex items-center space-x-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors",s?"bg-slate-700 text-white":"text-slate-300 hover:bg-slate-700 hover:text-white"),children:[e.icon,(0,a.jsx)("span",{children:e.label})]},e.href)})})]})}var p=t(1466),j=t(5236),g=t(4085);function v(e){let{user:s,pageTitle:t}=e,l=(0,r.useRouter)(),n=async()=>{await fetch("/api/auth/logout",{method:"POST"}),l.push("/login")};return(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between border-b border-slate-200 bg-white px-6",children:[(0,a.jsx)("div",{children:t&&(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:t})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"rounded-full bg-blue-100 p-2",children:(0,a.jsx)(p.A,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("div",{className:"font-medium text-slate-900",children:s.name}),(0,a.jsx)("div",{className:"text-slate-500",children:s.role.replace(/_/g," ")})]})]}),(0,a.jsxs)(g.$,{variant:"ghost",size:"sm",onClick:n,className:"flex items-center space-x-2",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Logout"})]})]})]})}function y(e){let{children:s,pageTitle:t}=e,n=(0,r.useRouter)(),[i,c]=(0,l.useState)(null),[d,x]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me"),s=await e.json();s.success&&s.user?c(s.user):n.push("/login")}catch(e){n.push("/login")}finally{x(!1)}})()},[n]),d)?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-slate-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-600 border-t-transparent mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-slate-600",children:"Loading..."})]})}):i?(0,a.jsxs)("div",{className:"flex h-screen bg-slate-50",children:[(0,a.jsx)(b,{userRole:i.role}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col overflow-hidden",children:[(0,a.jsx)(v,{user:i,pageTitle:t}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:s})]})]}):null}},9286:(e,s,t)=>{"use strict";t.d(s,{E:()=>r});var a=t(5155);t(2115);var l=t(9602);function r(e){let{className:s,status:t,children:r,...n}=e,i=t?(0,l.qY)(t):"";return(0,a.jsx)("div",{className:(0,l.cn)("inline-flex items-center rounded-full px-3 py-1 text-xs font-medium",i,s),...n,children:r||t})}},4085:(e,s,t)=>{"use strict";t.d(s,{$:()=>n});var a=t(5155),l=t(2115),r=t(9602);let n=l.forwardRef((e,s)=>{let{className:t,variant:l="primary",size:n="md",...i}=e;return(0,a.jsx)("button",{className:(0,r.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus-visible:ring-blue-600",secondary:"border border-slate-200 bg-transparent text-slate-700 hover:bg-slate-100 focus-visible:ring-slate-400",danger:"bg-red-500 text-white hover:bg-red-600 focus-visible:ring-red-500",ghost:"bg-transparent text-slate-500 hover:bg-slate-100 focus-visible:ring-slate-400"}[l],{sm:"h-9 px-3 text-sm",md:"h-10 px-4 py-2",lg:"h-11 px-8 text-lg"}[n],t),ref:s,...i})});n.displayName="Button"},5007:(e,s,t)=>{"use strict";t.d(s,{BT:()=>d,Wu:()=>x,ZB:()=>c,Zp:()=>n,aR:()=>i});var a=t(5155),l=t(2115),r=t(9602);let n=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border border-slate-200 bg-white shadow-sm",t),...l})});n.displayName="Card";let i=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",t),...l})});i.displayName="CardHeader";let c=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("h3",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",t),...l})});c.displayName="CardTitle";let d=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-slate-500",t),...l})});d.displayName="CardDescription";let x=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",t),...l})});x.displayName="CardContent",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",t),...l})}).displayName="CardFooter"},747:(e,s,t)=>{"use strict";t.d(s,{N:()=>a});let a=(0,t(838).UU)("https://rovlqyyjsfksgqbmxkwc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvdmxxeXlqc2Zrc2dxYm14a3djIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4ODU1OTgsImV4cCI6MjA3ODQ2MTU5OH0.RDqUziNPvtHu3rENURDu4pVE6fNnMh9wUgIQ-eZpSoQ")},9602:(e,s,t)=>{"use strict";t.d(s,{Yq:()=>i,cn:()=>r,qY:()=>d,r6:()=>c,vv:()=>n});var a=t(3463),l=t(9795);function r(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,l.QP)((0,a.$)(s))}function n(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(e)}function i(e){return new Intl.DateTimeFormat("en-IN",{year:"numeric",month:"short",day:"numeric"}).format(new Date(e))}function c(e){return new Intl.DateTimeFormat("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e))}function d(e){return({ACTIVE:"bg-green-100 text-green-800",INACTIVE:"bg-gray-100 text-gray-800",DRAFT:"bg-gray-100 text-gray-800",EXPIRED:"bg-red-100 text-red-800",CANCELLED:"bg-red-100 text-red-800",AVAILABLE:"bg-green-100 text-green-800",DISTRIBUTED:"bg-amber-100 text-amber-800",CLAIMED:"bg-blue-100 text-blue-800"})[e]||"bg-gray-100 text-gray-800"}},3239:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7401).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6878:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7401).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[946,749,441,517,358],()=>s(6850)),_N_E=e.O()}]);